---
import cases from "../data/corruption-cases.json";

const categoryColors: Record<string, string> = {
  "verejne-zakazky": "#ff3e3e",
  "eu-dotace": "#ffd93d",
  "obrana": "#6c5ce7",
  "energie": "#00b4d8",
  "infrastruktura": "#ff8c42",
};

function formatAmount(amount: number, unit: string) {
  if (amount >= 1000) return `${(amount / 1000).toFixed(amount % 1000 === 0 ? 0 : 1)} mld Kč`;
  return `${amount} ${unit}`;
}
---

<section id="korupce-kauzy" class="relative py-24 md:py-32 px-6">
  <div class="max-w-5xl mx-auto">
    <div class="mb-12 md:mb-16 max-w-2xl">
      <div class="w-12 h-1 mb-6 bg-accent-red"></div>
      <h2 class="font-heading text-text-heading text-3xl md:text-5xl font-bold mb-4 leading-tight">
        Kam mizí peníze
      </h2>
      <p class="text-text-muted text-base md:text-lg leading-relaxed">
        Předražené zakázky, zneužité dotace, sporné megaprojekty.
        Tohle jsou největší korupční kauzy poslední dekády — a jejich odhadovaná cena.
      </p>
    </div>

    <div class="relative">
      <div class="absolute left-4 md:left-6 top-0 bottom-0 w-px bg-border"></div>

      {cases.cases.map((c) => (
        <div class="corruption-case relative pl-12 md:pl-16 pb-10 md:pb-14 opacity-0 translate-y-4
                    transition-all duration-500 ease-out">
          <div
            class="absolute left-2.5 md:left-4.5 top-1 w-3 h-3 rounded-full border-2 border-bg"
            style={`background-color: ${categoryColors[c.category] || "#ff3e3e"};`}
          ></div>

          <div class="text-text-muted text-xs md:text-sm font-mono mb-1">{c.year}</div>
          <div class="flex flex-col md:flex-row md:items-baseline gap-1 md:gap-3 mb-2">
            <h3 class="font-heading text-text-heading text-lg md:text-xl font-bold">{c.name}</h3>
            <span
              class="text-sm md:text-base font-bold font-mono"
              style={`color: ${categoryColors[c.category] || "#ff3e3e"};`}
            >
              {formatAmount(c.amount, c.unit)}
            </span>
          </div>
          <p class="text-text-muted text-sm leading-relaxed max-w-lg">{c.description}</p>
        </div>
      ))}
    </div>

    <div class="mt-4 pt-3 border-t border-border/50">
      <a
        href={cases.source.url}
        target="_blank"
        rel="noopener noreferrer"
        class="text-text-muted/60 text-[10px] md:text-xs hover:text-text-muted transition-colors duration-200"
      >
        Zdroj: {cases.source.name} &nearr;
      </a>
    </div>
  </div>
</section>

<script>
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (!entry.isIntersecting) return;
      entry.target.classList.remove("opacity-0", "translate-y-4");
      entry.target.classList.add("opacity-100", "translate-y-0");
      observer.unobserve(entry.target);
    });
  }, { threshold: 0.2 });

  document.querySelectorAll<HTMLElement>(".corruption-case").forEach(el => observer.observe(el));
</script>
