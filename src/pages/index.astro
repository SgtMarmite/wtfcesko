---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import Nav from "../components/Nav.astro";
import ClosingSection from "../components/ClosingSection.astro";
import Footer from "../components/Footer.astro";
import Act1 from "../components/acts/Act1.astro";
import Act2 from "../components/acts/Act2.astro";
import Act3 from "../components/acts/Act3.astro";
import Act4 from "../components/acts/Act4.astro";
import Act5 from "../components/acts/Act5.astro";
import Act6 from "../components/acts/Act6.astro";
import "../styles/global.css";
---

<Layout title="WTF Česko — Co se stalo s českou ekonomikou?">
  <Nav />
  <main>
    <Hero />
    <Act1 />
    <Act2 />
    <Act3 />
    <Act4 />
    <Act5 />
    <Act6 />
    <ClosingSection />
  </main>
  <Footer />
</Layout>

<script>
  import Chart from "chart.js/auto";
  import { chartConfigs } from "../lib/chart-configs";

  const configs = { ...chartConfigs };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (!entry.isIntersecting) return;

      const container = entry.target as HTMLElement;
      const chartId = container.dataset.chartId!;

      container.classList.remove("opacity-0", "translate-y-8");
      container.classList.add("opacity-100", "translate-y-0");

      if (configs[chartId]) {
        const args = configs[chartId]();
        new Chart(...args);
        delete configs[chartId];
      }

      observer.unobserve(container);
    });
  }, { threshold: 0.15 });

  document.querySelectorAll<HTMLElement>(".chart-container").forEach(el => observer.observe(el));
</script>
